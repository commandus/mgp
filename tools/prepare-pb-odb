#!/bin/bash
F=$1
DT=`date --rfc-2822`
echo $F

PRECLASS=' private:\
  friend class odb::access;\
  \/\/ @@prepare-pb-odb-class(\1\.\2)\
'

PRIV='\
\
public:\
  const std::vector<\1::$(ACCESSVECTORCLASS)*> m$SB;\
\
  std::vector<\1::$(ACCESSVECTORCLASS)*>\& get$SB() const\
  {\
	  std::vector<\1::$(ACCESSVECTORCLASS)*> *r = (std::vector<\1::$(ACCESSVECTORCLASS)*>*) \&m$SB;\
	  r->clear();\
	  const \1::$(ACCESSVECTORCLASS)* const* d = $SB_.data();\
	  for (int i = 0; i < r->size(); i++)\
	  {\
		  r->push_back((\1::$(ACCESSVECTORCLASS)*) *d);\
		  d++;\
	  }\
	return *r;\
  };\
\
  void set$SB(std::vector<\1::$(ACCESSVECTORCLASS)*> v)\
  {\
	  $SB_.Clear();\
	  for (std::vector<\1::$(ACCESSVECTORCLASS)*>::iterator it = v.begin(); it != v.end(); ++it)\
	  {\
		  \1::$(ACCESSVECTORCLASS)* h = $SB_.Add();\
		  h = *it;\
	  }\
  };\
  private:\
'
# once
sed -i "s/@@protoc_insertion_point(\(includes\))/@@protoc_insertion_point(\1)\n\/\/-- autogenerated by prepare-pb-odb $DT --\n\/\/-- \1 --\n#include <odb\/core.hxx>/" $F
# each class just in case
sed -i "s/\ \ \/\/ @@protoc_insertion_point(class_scope:\(.*\)\.\(.*\))/  \/\/ @@protoc_insertion_point(class_scope:\1\.\2)\n$PRECLASS/" $F

function addvector {
	sed -i "s/\ \ \/\/ @@prepare-pb-odb-class(\(.*\)\.\($1\))/  \/\/ @@prepare-pb-odb-class(\1\.\2)\n$PRIV/" $F
	sed -i "s/\$SB/$2/g" $F
	sed -i "s/\$(ACCESSVECTORCLASS)/$3/g" $F
}

# repeated members like
# addvector Person medias MediaFile
# addvector Employee medias MediaFile
# addvector Org medias MediaFile
